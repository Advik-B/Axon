syntax = "proto3";

package axon;

option go_package = "github.com/Advik-B/Axon/pkg/axon";

// NodeType defines the behavior of a node.
enum NodeType {
    NODE_UNKNOWN = 0;
    START = 1;          // The entry point for an execution flow.
    END = 2;            // The termination point for an execution flow.
    CONSTANT = 3;       // Provides a static value.
    FUNCTION = 4;       // Calls a Go function (e.g., "fmt.Println").
    OPERATOR = 5;       // Performs a binary operation (e.g., "+", "==").
    IGNORE = 6;         // Explicitly discards an input value (like `_` in Go).
    RETURN = 7;         // Returns a value from the graph's function scope.
}

// VisualInfo stores the position and dimensions of a node for a GUI.
// This is ignored by the transpiler.
message VisualInfo {
    float x = 1;
    float y = 2;
    float width = 3;
    float height = 4;
}

// Port represents a connection point for data on a node.
message Port {
    string name = 1;      // The name of the port (e.g., "a", "result").
    string type_name = 2; // The Go type this port handles (e.g., "string", "*http.Request").
}

// A Node is the core building block of an Axon graph.
message Node {
    string id = 1;                   // Unique node ID within the graph.
    NodeType type = 2;              // The behavior of this node.
    string label = 3;               // Human-readable name used for variable naming.
    repeated Port inputs = 4;       // Data input ports.
    repeated Port outputs = 5;      // Data output ports.

    // For FUNCTION nodes, this specifies the Go function to call.
    // Example: "fmt.Println", "os.ReadFile"
    string impl_reference = 6;

    // Node-specific configuration.
    // For CONSTANT: "value" -> "\"hello\"", "123"
    // For OPERATOR: "op" -> "+", "-"
    map<string, string> config = 7;

    // Optional visual information.
    VisualInfo visual_info = 8;
}

// DataEdge represents a data dependency between two nodes.
message DataEdge {
    string from_node_id = 1;
    string from_port = 2;
    string to_node_id = 3;
    string to_port = 4;
}

// ExecEdge represents an execution dependency between two nodes.
message ExecEdge {
    string from_node_id = 1;
    string to_node_id = 2;
}

// A Graph is a complete Axon visual program.
message Graph {
    string id = 1;
    string name = 2;

    repeated Node nodes = 3;
    repeated DataEdge data_edges = 4;
    repeated ExecEdge exec_edges = 5;
}